<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Performance Driven Development usando .NET com MiniProfiler - Paulo Ortins</title>
	<meta name="author" content="Paulo Ortins">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	
	<link rel="canonical" href="/2013/04/28/performance-driven-development-usando-net-com-miniprofiler/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/main.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/syntax.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>	
  	
</head>


<body>
  <div class="container">
    <div class="left-col">
      <div class="intrude-less">
        <header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/a1c6e240931b44f7f4b21492232cd3fc.png?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">Paulo Ortins</a></h1>
  
</hgroup>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about/">about</a></li>
  <li><a href="/archives">archives</a></li>
</ul>


</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
	</div>
</nav></header>        
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Performance Driven Development usando .NET com MiniProfiler</h1>	
	<div class="entry-content" itemprop="articleBody"><p>No <a title="último post" href="http://pauloortins.wordpress.com/2013/04/23/performance-importa-e-muito/">último post</a> falei um pouco sobre a importância de se importar com a performance das nossas páginas, assim como, o quanto uma perfomance ruim impacta nos negócios das empresas. Nesse post vou falar como podemos estar mensurando a nossa performance.</p>
<p><strong>MiniProfiler</strong></p>
<p>O MiniProfiler é um framework desenvolvido pela equipe do <a title="Stack Overflow" href="http://stackoverflow.com/">Stack Overflow</a> e usando em produção tanto no Stack Overflow como no <a title="StackExchange" href="http://stackexchange.com/">StackExchange</a>. É leve, fácil de usar, e o melhor de tudo, é free e seu código está <a title="hospedado no GitHub :D" href="https://github.com/SamSaffron/MiniProfiler">hospedado no GitHub :D</a></p>
<p><strong>Como funciona</strong></p>
<p>O MiniProfiler não faz o profile automático de todos os métodos, ele teria que interagir com a CLR para observar quais métodos estão sendo executados, e isso é considerado pelo Core Team como muito invasivo.</p>
<p>Ao contrário, nós temos que adicionar Steps ao nosso código indicando as áreas que iremos fazer o profile.</p>
<p><strong>Usando o MiniProfiler</strong></p>
<p>Para exemplificar o uso do MiniProfiler, vamos criar uma aplicação padrão ASP.NET MVC4 chamada TestandoMiniProfiler.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/04/criacao-aplicacao1.png"><img class="alignnone size-full wp-image-238" alt="Criacao Aplicacao" src="http://pauloortins.com/wp-content/uploads/2013/04/criacao-aplicacao1.png" width="710" height="432" /></a></p>
<p>Para instalar o MiniProfiler basta executarmos o comando <em>Install-Package MiniProfiler.MVC3</em> no Package Manager Console.<br />
Nota: a versão é MVC3 mesmo !</p>
<p><a href="http://pauloortins.files.wordpress.com/2013/04/instalando.png"><img class="alignnone size-full wp-image-239" alt="Instalando" src="http://pauloortins.com/wp-content/uploads/2013/04/instalando1.png" width="710" height="382" /></a></p>
<div class="highlight"><pre><code class="html">@using StackExchange.Profiling @* Usando o MiniProfiler *@

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
   <span class="nt">&lt;header&gt;&lt;/header&gt;</span>
   <span class="nt">&lt;footer&gt;&lt;/footer&gt;</span>

   @Scripts.Render(&quot;~/bundles/jquery&quot;)
   @RenderSection(&quot;scripts&quot;, required: false)

   @* Renderizando CSS e Javascript*@
   @MiniProfiler.RenderIncludes()
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>Adicionando os arquivos css e javascript ao final da tag <em>body</em> no arquivo <em>_Layout.shtml</em>.</p>
<p>Por último vamos configurar alguns Steps para demonstração e pronto, temos o MiniProfiler funcionando !</p>
<div class="highlight"><pre><code class="c#"><span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">()</span>
<span class="p">{</span>
   <span class="kt">var</span> <span class="n">profiler</span> <span class="p">=</span> <span class="n">MiniProfiler</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span> <span class="c1">// it&#39;s ok if this is null</span>
   <span class="k">using</span> <span class="p">(</span><span class="n">profiler</span><span class="p">.</span><span class="n">Step</span><span class="p">(</span><span class="s">&quot;Alterando Mensagem Inicial&quot;</span><span class="p">))</span>
   <span class="p">{</span>
      <span class="n">ViewBag</span><span class="p">.</span><span class="n">Message</span> <span class="p">=</span> <span class="s">&quot;Nova mensagem inicial&quot;</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">using</span> <span class="p">(</span><span class="n">profiler</span><span class="p">.</span><span class="n">Step</span><span class="p">(</span><span class="s">&quot;Sub-Steps&quot;</span><span class="p">))</span>
   <span class="p">{</span>
      <span class="k">using</span> <span class="p">(</span><span class="n">profiler</span><span class="p">.</span><span class="n">Step</span><span class="p">(</span><span class="s">&quot;Sleep 100ms&quot;</span><span class="p">))</span>
      <span class="p">{</span>
         <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">using</span> <span class="p">(</span><span class="n">profiler</span><span class="p">.</span><span class="n">Step</span><span class="p">(</span><span class="s">&quot;Sleep 250ms&quot;</span><span class="p">))</span>
      <span class="p">{</span>
         <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">250</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Se tudo ocorreu bem, devemos ver uma tela parecida com essa, onde podemos ver o tempo de execução de cada parte do nosso código ! Rápido, fácil, e pronto pra produção !</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/04/results.png"><img class="alignnone size-full wp-image-250" alt="results" src="http://pauloortins.com/wp-content/uploads/2013/04/results.png" width="710" height="503" /></a></p>
<p><strong>Recursos Utilizados:</strong></p>
<p><a title="MiniProfiler.com" href="http://miniprofiler.com/">MiniProfiler.com</a><br />
<a title="Blog do Scott Hanselman" href="http://www.hanselman.com/blog/NuGetPackageOfTheWeek9ASPNETMiniProfilerFromStackExchangeRocksYourWorld.aspx">Blog do Scott Hanselman</a></p>
</div>
</article>

<div data-type="ad" data-publisher="lqm.youvebeenhacked.site" data-zone="ron" data-format="728x90"></div>


	


<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/2013/04/16/mapreduce-com-python-utilizando-mincemeat-py/" title="Previous Post: 
MapReduce com python utilizando mincemeat.py">&laquo; MapReduce com python utilizando mincemeat.py</a>
         
        </div>

        <div class="next"> 
         
               <a href="/2013/05/06/jasmine-javascript-unit-tests/" title="next Post: 
Jasmine, you have to write javascript unit tests!">Jasmine, you have to write javascript unit tests! &raquo; </a> 
         
        </div>
</div> </div>
      </div>
      <footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Paulo Ortins - Blog content under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a>
</p>
</footer>
    </div>
  </div>

</body>
</html>