<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Jasmine, you have to write javascript unit tests! - Paulo Ortins</title>
	<meta name="author" content="Paulo Ortins">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	
	<link rel="canonical" href="/2013/05/06/jasmine-javascript-unit-tests/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="http://www.gravatar.com/avatar/a1c6e240931b44f7f4b21492232cd3fc.png" rel="shortcut icon">
	<link href="/css/main.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/syntax.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>	
  	
</head>


<body>
  <div class="container">
    <div class="left-col">
      <div class="intrude-less">
        <header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/a1c6e240931b44f7f4b21492232cd3fc.png?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">Paulo Ortins</a></h1>
  
</hgroup>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about/">about</a></li>
  <li><a href="/archives">archives</a></li>
</ul>


</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
	</div>
</nav></header>        
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Jasmine, you have to write javascript unit tests!</h1>	
	<div class="entry-content" itemprop="articleBody"><p>Some time ago I wrote about how important is to write unit tests for our code, you can read it <a href="http://pauloortins.com/tdd-test-driven-development/" title="Intro to TDD â€“ Test-Driven Development">here</a>.</p>
<p>Today, I have seen a lot of developers talking about unit tests, but the majority of these efforts are focused to backend. My team is a example, we have a good coverage on our backend code but we leave the javascript code to be tested by the browser tests. Is it wrong ?</p>
<p>IMO, YES ! First of all, browser tests are slow, and they don't fail beautiful, we have less fail information in a acceptance tests than we would have in a unit test, and second, javascript is the language of the moment, jQuery, became interactive applications creation easier, and a lot of javascript frameworks have been created in the recent years, e.g. <a href="http://nodejs.org/">node.js</a>, <a href="http://backbonejs.org/">backbone.js</a>, <a href="http://angularjs.org/">angular.js</a>, <a href="http://emberjs.com/">ember.js</a> and so on. It's not a surprise that javascript is the most used language in <a href="https://github.com/languages">GitHub</a>.</p>
<p>With these informations, I googled for some unit test frameworks for javascript. The most used are:</p>
<p><a href="http://qunitjs.com/">QUnit</a>, framework created in 2009 by the jQuery Team.<br />
<a href="http://visionmedia.github.io/mocha/">Mocha</a>, bdd framework integrated with node.js.<br />
<a href="http://pivotal.github.io/jasmine/">Jasmine</a>, as Mocha, is a bdd framework and we will use this one in this post.</p>
<h1><strong>Jasmine</strong></h1>
<p>Jasmine was created due the dissatisfaction from the creators with existing framworks, between these dissatisfactions are the fact what most of them don't support async tests and others have a ugly syntax, hard to understand. Jasmine was born with the following ideas:</p>
<ul>
<li>RSpec based, from Ruby/li>
<li>Should encourage good tests practice</li>
<li>Easily integrated with build systems</li>
<li>And of course, easy to use</li>
</ul>
<p><strong>How Jasmine works</strong></p>
<p><em>Describe</em></p>
<p>A Jasmine test suite starts with a <em>describe</em> declaration that is a function that receive two parameters, the test suite name, and another function that will implement the tests.</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;My test suite&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
</code></pre></div>
<p><br/><br />
<em>It</em></p>
<p>The tests are implemented by the <em>It</em> function, that as <em>describe</em>, receive two parameters, the test name, and the function that represents the test.</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;My test suite&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  
  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;testing a positive case&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;testing a negative case&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>
<p><br/><br />
<em>Expect/Matchers</em></p>
<p>The <em>expects</em> in jasmine are made by the <em>matchers</em>, that will compare the actual value with the expected value. The matchers can execute a negative assert using the <em>not</em> operator.</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;My test suite&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  
  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;testing a positive case&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">});</span>
  
  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;testing a negative case&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>
<p><br/></p>
<p>The Jasmine by default has a lot of <em>matchers</em>, but it's extensible, new <em>matchers</em> can be added to <em>framework</em>.</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">addMatchers</span><span class="p">({</span>
    <span class="nx">shouldBeLessThan</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">actual</span> <span class="o">&lt;</span> <span class="nx">expected</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><br/><br />
<em>Setup/Teardown</em></p>
<p>Jasmine has support to <em>Setup</em> (functions that will be executed <strong>before</strong> each test) and to the <em>Teardown</em> (functions that will be executed <strong>after</strong> each test).</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;My test suite&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="c1">// Function that will be executed BEFORE each test</span>
  <span class="p">});</span>

  <span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="c1">// Function that will be executed AFTER each test</span>
  <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>
<p><br/><br />
<em>Spies</em></p>
<p>Jasmine has support to <em>Mocks</em> using <em>Spies</em>, and also provide some custom matchers to make asserts using spies.</p>
<p><em>toHaveBeenCalled</em>, will return true if the spy was called</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;My suite test&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">student</span><span class="p">,</span> <span class="nx">grade</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">student</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">setGrade</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">grade</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">spyOn</span><span class="p">(</span><span class="nx">student</span><span class="p">,</span> <span class="s1">&#39;setGrade&#39;</span><span class="p">);</span>

    <span class="nx">student</span><span class="p">.</span><span class="nx">setGrade</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;verify if setGrade was called&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">student</span><span class="p">.</span><span class="nx">setGrade</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><br/><br />
<em>andReturn</em>, will mock a object, and all calls will return the same value</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;A spy, when faking a return value&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">student</span><span class="p">,</span> <span class="nx">grade</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">student</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">setGrade</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">grade</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">getGrade</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">grade</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">spyOn</span><span class="p">(</span><span class="nx">student</span><span class="p">,</span> <span class="s1">&#39;getGrade&#39;</span><span class="p">).</span><span class="nx">andReturn</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;verify if it is the mocked grade&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">student</span><span class="p">.</span><span class="nx">getGrade</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><br/><br />
In the next post, I will show how to use <strong>Jasmine</strong> in practice, creating a <em>Code Kata</em> using BDD and Jasmine :)</p>
<p>For more info, I recommend the Jasmine page:</p>
<p><a href="http://pivotal.github.io/jasmine/">Jasmine</a></p>
</div>
</article>

<div data-type="ad" data-publisher="lqm.youvebeenhacked.site" data-zone="ron" data-format="728x90"></div>


	


<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/2013/04/28/performance-driven-development-usando-net-com-miniprofiler/" title="Previous Post: 
Performance Driven Development usando .NET com MiniProfiler">&laquo; Performance Driven Development usando .NET com MiniProfiler</a>
         
        </div>

        <div class="next"> 
         
               <a href="/2013/05/08/code-kata-javascript-jasmine/" title="next Post: 
Practicing programming with Code Kata and Javascript/Jasmine">Practicing programming with Code Kata and Javascript/Jasmine &raquo; </a> 
         
        </div>
</div> </div>
      </div>
      <footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Paulo Ortins - Blog content under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a>
</p>
</footer>
    </div>
  </div>

</body>
</html>