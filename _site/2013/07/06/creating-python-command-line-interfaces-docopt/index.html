<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Creating python command line applications with docopt - Paulo Ortins</title>
	<meta name="author" content="Paulo Ortins">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	
	<link rel="canonical" href="/2013/07/06/creating-python-command-line-interfaces-docopt/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/main.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/syntax.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>	
  	
</head>


<body>
  <div class="container">
    <div class="left-col">
      <div class="intrude-less">
        <header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/a1c6e240931b44f7f4b21492232cd3fc.png?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">Paulo Ortins</a></h1>
  
</hgroup>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about/">about</a></li>
  <li><a href="/archives">archives</a></li>
</ul>


</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
	</div>
</nav></header>        
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Creating python command line applications with docopt</h1>	
	<div class="entry-content" itemprop="articleBody"><p><h2>Introduction</h2></p>
<p>Few weeks ago I wrote a blog post showing how we can write command line applications using <a href="http://docs.python.org/dev/library/argparse.html">argparse</a>, you can check out it <a href="http://pauloortins.com/creating-python-command-line-applications/" title="Creating python command-line applications">here</a>. Some people suggested me to try <a href="https://github.com/docopt/docopt">docopt</a> and this post is a result from this experience.</p>
<p><h2>Docopt, the Pythonic command line arguments parser, that will make you smile</h2></p>
<p><iframe width="560" height="315" src="//www.youtube.com/embed/pXhcPJK5cMc?rel=0" frameborder="0" allowfullscreen></iframe></p>
<p><h2>What is it ?</h2></p>
<p>Docopt, like optparse and argparse, is a small library that simplifies the task to write command-line interfaces. But it came with a different idea.</p>
<p>How optparse and argparse work ? You have to read the documentation and write code that will provide guidelines to parse args. A example of this approach is the code that I wrote in my previous post. And being honest, I looked the documentation several times, trying to understand how each method works.</p>
<div class="highlight"><pre><code class="python"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;operation&quot;</span><span class="p">,</span> 
	<span class="n">help</span><span class="o">=</span><span class="s">&quot;mathematical operation that will be performed&quot;</span><span class="p">,</span> 
	<span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;subtract&#39;</span><span class="p">,</span> <span class="s">&#39;multiply&#39;</span><span class="p">,</span> <span class="s">&#39;divide&#39;</span><span class="p">])</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num1&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the first number&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num2&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the second number&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</code></pre></div>
<p>How docopt works ? When we are designing a command-line interface, we write or we should write, our application documentation, right ? Docopt uses this docstring to parse the args. Look at this example extracted from documentation:</p>
<div class="highlight"><pre><code class="python"><span class="sd">&quot;&quot;&quot;Naval Fate.</span>

<span class="sd">Usage:</span>
<span class="sd">  naval_fate.py ship new &lt;name&gt;...</span>
<span class="sd">  naval_fate.py ship &lt;name&gt; move &lt;x&gt; &lt;y&gt; [--speed=&lt;kn&gt;]</span>
<span class="sd">  naval_fate.py ship shoot &lt;x&gt; &lt;y&gt;</span>
<span class="sd">  naval_fate.py mine (set|remove) &lt;x&gt; &lt;y&gt; [--moored|--drifting]</span>
<span class="sd">  naval_fate.py -h | --help</span>
<span class="sd">  naval_fate.py --version</span>

<span class="sd">Options:</span>
<span class="sd">  -h --help     Show this screen.</span>
<span class="sd">  --version     Show version.</span>
<span class="sd">  --speed=&lt;kn&gt;  Speed in knots [default: 10].</span>
<span class="sd">  --moored      Moored (anchored) mine.</span>
<span class="sd">  --drifting    Drifting mine.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;Naval Fate 2.0&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</code></pre></div>
<p>When I saw it for the first time, I had a "holy shit" moment and said "It won't work", but it works! You will avoid to read documentation and to write parse code, all you have to do is writing your application documentation and instantly you have your application running with all options and help messages working properly!</p>
<p><h2>Coming back to the calculator example</h2></p>
<p>In my first post about command line interfaces I built two command calculators, one using python w/o libraries and other using argparse. So to compare these libraries, let's build another calculator, in this time, using docopt. This is our documentation:</p>
<div class="highlight"><pre><code class="python"><span class="o">/*</span>
<span class="n">We</span> <span class="n">are</span> <span class="n">going</span> <span class="n">to</span> <span class="n">create</span> <span class="n">a</span> <span class="n">command</span><span class="o">-</span><span class="n">line</span> <span class="n">calculator</span><span class="o">.</span> 
<span class="n">The</span> <span class="n">calculator</span> <span class="n">should</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">way</span><span class="p">:</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">add</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">4</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">subtract</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">0</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">multiply</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">4</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">divide</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">1</span>
   
<span class="o">*/</span>
</code></pre></div>
<p>Let's transform it in the docopt pattern, that is the pattern of almost all command-line applications.</p>
<div class="highlight"><pre><code class="python"><span class="sd">&quot;&quot;&quot;Calculator using docopt</span>

<span class="sd">Usage:</span>
<span class="sd">  calc_docopt.py operation &lt;num1&gt; &lt;num2&gt;</span>
<span class="sd">  calc_docopt.py (-h | --help)</span>

<span class="sd">Arguments</span>
<span class="sd">  &lt;operation&gt; Math Operation</span>
<span class="sd">  &lt;num1&gt; First Number</span>
<span class="sd">  &lt;num2&gt; Second Number</span>

<span class="sd">Options:</span>
<span class="sd">  -h --help     Show this screen.</span>

<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>Now, let's add the docopt code, don't be afraid of that. With 3-4 lines of code our parser are done.</p>
<div class="highlight"><pre><code class="python"><span class="sd">&quot;&quot;&quot;Calculator using docopt</span>

<span class="sd">Usage:</span>
<span class="sd">  calc_docopt.py operation &lt;num1&gt; &lt;num2&gt;</span>
<span class="sd">  calc_docopt.py (-h | --help)</span>

<span class="sd">Arguments</span>
<span class="sd">  &lt;operation&gt; Math Operation</span>
<span class="sd">  &lt;num1&gt; First Number</span>
<span class="sd">  &lt;num2&gt; Second Number</span>

<span class="sd">Options:</span>
<span class="sd">  -h --help     Show this screen.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;Calculator with docopt&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</code></pre></div>
<p><h2>Help Messages</h2></p>
<p>Let's see some of the messages that docopt provide for us.</p>
<p>Help message</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_docopt</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">help</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Calculator</span> <span class="n">using</span> <span class="n">docopt</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Usage</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="n">calc_docopt</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;</span><span class="n">operation</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">num1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">num2</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="n">calc_docopt</span><span class="o">.</span><span class="n">py</span> <span class="p">(</span><span class="o">-</span><span class="n">h</span> <span class="o">|</span> <span class="o">--</span><span class="n">help</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">Arguments</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="o">&lt;</span><span class="n">operation</span><span class="o">&gt;</span> <span class="n">Math</span> <span class="n">Operation</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="o">&lt;</span><span class="n">num1</span><span class="o">&gt;</span> <span class="n">First</span> <span class="n">Number</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="o">&lt;</span><span class="n">num2</span><span class="o">&gt;</span> <span class="n">Second</span> <span class="n">Number</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">Options</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="o">-</span><span class="n">h</span> <span class="o">--</span><span class="n">help</span>     <span class="n">Show</span> <span class="n">this</span> <span class="n">screen</span><span class="o">.</span>
</code></pre></div>
<p>Invalid Arguments</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_docopt</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Usage</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="n">calc_docopt</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;</span><span class="n">operation</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">num1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">num2</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>   <span class="n">calc_docopt</span><span class="o">.</span><span class="n">py</span> <span class="p">(</span><span class="o">-</span><span class="n">h</span> <span class="o">|</span> <span class="o">--</span><span class="n">help</span><span class="p">)</span>
</code></pre></div>
<p><h2>Operations</h2></p>
<p>Our work right now is to coding the calculator operations. I will respect the <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY’s</a> gods and copy the operations from the other post.</p>
<div class="highlight"><pre><code class="python"><span class="sd">&quot;&quot;&quot;Calculator using docopt</span>

<span class="sd">Usage:</span>
<span class="sd">  calc_docopt.py &lt;operation&gt; &lt;num1&gt; &lt;num2&gt;</span>
<span class="sd">  calc_docopt.py (-h | --help)</span>

<span class="sd">Arguments</span>
<span class="sd">  num1 First Number</span>
<span class="sd">  num2 Second Number</span>

<span class="sd">Options:</span>
<span class="sd">  -h --help     Show this screen.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;Calculator with docopt&#39;</span><span class="p">)</span>
    <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;add&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">,</span>
        <span class="s">&#39;subtract&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="p">,</span>
        <span class="s">&#39;multiply&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">,</span>
        <span class="s">&#39;divide&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span>
    <span class="p">}</span>

    <span class="k">print</span> <span class="n">functions</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;&lt;operation&gt;&#39;</span><span class="p">]](</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;&lt;num1&gt;&#39;</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;&lt;num2&gt;&#39;</span><span class="p">]))</span>
</code></pre></div>
<p>Our calculator now performs math operations as we expect.</p>
<p><h2>Input Validation</h2></p>
<p>If you are a good observer, you will see that our calculator lacks type parse/checking and operation checking. It's easier to accomplish it with argparse. But docopt doesn't have built-in input validations.</p>
<blockquote><p>
docopt does one thing and does it well: it implements your command-line interface. However it does not validate the input data. On the other hand there are libraries like python schema which make validating data a breeze.<br />
- docopt documentation
</p></blockquote>
<p>You can get more info about python schema <a href="https://github.com/halst/schema">here</a>.</p>
<p><h2>Conclusion</h2></p>
<p>Docopt is a new approach to write command apps. You can easily build apps. We can only appreciate <a href="http://keleshev.com">Vladimir Keleshev's</a> work and hope that it continues to improving and why not conquest a place in python core ?</p>
</div>
</article>

<div data-type="ad" data-publisher="lqm.youvebeenhacked.site" data-zone="ron" data-format="728x90"></div>


	


<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/2013/07/01/most-influential-programming-books/" title="Previous Post: 
The Most Influential Programming Books to Me as Developer">&laquo; The Most Influential Programming Books to Me as Developer</a>
         
        </div>

        <div class="next"> 
         
               <a href="/2013/07/07/what-are-code-smells/" title="next Post: 
What are Code Smells ?">What are Code Smells ? &raquo; </a> 
         
        </div>
</div> </div>
      </div>
      <footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Paulo Ortins - Blog content under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a>
</p>
</footer>
    </div>
  </div>

</body>
</html>