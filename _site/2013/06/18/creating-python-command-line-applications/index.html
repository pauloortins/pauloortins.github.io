<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Creating python command-line applications - Paulo Ortins</title>
	<meta name="author" content="Paulo Ortins">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	
	<link rel="canonical" href="/2013/06/18/creating-python-command-line-applications/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/main.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/syntax.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>	
  	
</head>


<body>
  <div class="container">
    <div class="left-col">
      <div class="intrude-less">
        <header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/a1c6e240931b44f7f4b21492232cd3fc.png?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">Paulo Ortins</a></h1>
  
</hgroup>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about/">about</a></li>
  <li><a href="/archives">archives</a></li>
</ul>


</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
	</div>
</nav></header>        
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Creating python command-line applications</h1>	
	<div class="entry-content" itemprop="articleBody"><p>For those who comes from .NET or Java, one of best things about python or ruby is the capability to write scripts. These little programs can solve a lot of problems like move files in a CI Server, clean some data, run tests and so on. When we are learning python, we have to learn also to use python scripts, everybody uses the following commands when we are installing a python library:</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</code></pre></div>
<p>Or we use the following command when we are programming with django:</p>
<div class="highlight"><pre><code class="python"><span class="n">django</span><span class="o">-</span><span class="n">admin</span><span class="o">.</span><span class="n">py</span> <span class="n">startproject</span> <span class="n">mysite</span>
</code></pre></div>
<p><h2>Building a command-line application<br />
</h2></p>
<p>In this post, we are going to learn how we can build a command-line calculator. Below is our application backlog:</p>
<div class="highlight"><pre><code class="python"><span class="o">/*</span>
<span class="n">We</span> <span class="n">are</span> <span class="n">going</span> <span class="n">to</span> <span class="n">create</span> <span class="n">a</span> <span class="n">command</span><span class="o">-</span><span class="n">line</span> <span class="n">calculator</span><span class="o">.</span> 
<span class="n">The</span> <span class="n">calculator</span> <span class="n">should</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">way</span><span class="p">:</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">add</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">4</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">subtract</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">0</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">multiply</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">4</span>

<span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="n">divide</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">1</span>
   
<span class="o">*/</span>
</code></pre></div>
<p><h2>Using sys.argv</h2></p>
<p>When calling a python script, our arguments are stored in sys.argv variable in the following order: Script Name + arguments, so we can print each argument in this way:</p>
<div class="highlight"><pre><code class="python"><span class="c"># calc.py</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
	<span class="k">print</span> <span class="n">arg</span>
</code></pre></div>
<p>And here we are printing our arguments:</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="o">&gt;</span> <span class="n">calc</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;</span> <span class="mi">1</span>
<span class="o">&gt;</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="mi">3</span>
</code></pre></div>
<p><h2>Building our calculator</h2></p>
<p>We already know how we can get our arguments, now we can implement the operations:</p>
<p><h2>Implementing Add</h2></p>
<div class="highlight"><pre><code class="python"><span class="c"># calc.py</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">operation</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">num1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">num2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
	<span class="n">total</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span>

<span class="k">print</span> <span class="n">total</span>	
</code></pre></div>
<p><h2>Other Operations</h2></p>
<p>Implement the other operations is straightforward, we can easily code them:</p>
<div class="highlight"><pre><code class="python"><span class="c"># calc.py</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">operation</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">num1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">num2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
	<span class="n">total</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span>
<span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;subtract&#39;</span><span class="p">:</span>
	<span class="n">total</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span>
<span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;multiply&#39;</span><span class="p">:</span>
	<span class="n">total</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span>
<span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;divide&#39;</span><span class="p">:</span>
	<span class="n">total</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span>

<span class="k">print</span> <span class="n">total</span>
</code></pre></div>
<p><h2>A switch..case situation ?</h2></p>
<p>Python, unlike many OO languages, doesn't have switch..case statement and if it can be seen as a disadvantage  at first look, it has a reason! When we use switch..case, in most of cases it indicates that there should be a polymorphic call there. But if..elif is bad as switch..case. We can write it in a more elegant way using dictionaries and functional programming. So we end up with the following code:</p>
<div class="highlight"><pre><code class="python"><span class="c"># calc.py</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">operation</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">num1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">num2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&#39;add&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;subtract&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;multiply&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;divide&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span>
<span class="p">}</span>

<span class="n">total</span> <span class="o">=</span> <span class="n">functions</span><span class="p">[</span><span class="n">operation</span><span class="p">](</span><span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">)</span>

<span class="k">print</span> <span class="n">total</span>
</code></pre></div>
<p>Much better!</p>
<p><h2>Just a toy application</h2></p>
<p>It’s just a toy application. People don’t write command-line applications in this way. Real command-line applications have error checking, flags, help and other things. Instead it, people use modules that help to achieve these requirements. Some of the existent options are:</p>
<ul>
<li><a href="http://docs.python.org/dev/library/argparse.html">argparse</a></li>
<li><a href="http://docopt.org/">docopt</a></li>
</ul>
<p><h2>Using argparse to write a more robust application</h2></p>
<p>Argparse makes easy to write command-line applications. You provide info about the parameters and argparse parse those out of sys.argv. It also provides help, usage messages and issues errors.</p>
<p><h2>A basic program</h2></p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</code></pre></div>
<p>This program does nothing. But we can already see the error messages, help and usage tips.</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span> <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">flag</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">unrecognized</span> <span class="n">arguments</span><span class="p">:</span> <span class="o">--</span><span class="n">flag</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">arg</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">unrecognized</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">arg</span>
</code></pre></div>
<p><h2>Adding arguments</h2></p>
<p>Our command-line calculator does nothing, so let's start to add the parameters. The first parameter will be the operation.</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;operation&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">print</span> <span class="n">args</span><span class="o">.</span><span class="n">operation</span>
</code></pre></div>
<p>Let's see how argparse parses arguments and shows error and help messages.</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">operation</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">too</span> <span class="n">few</span> <span class="n">arguments</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">operation</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">operation</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span> <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="nb">sum</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">sum</span>
</code></pre></div>
<p><h2>Better help messages</h2></p>
<p>Everything is working fine. But if we look carefully, what operation means ? We should have a help message. With argparse we can do it when we add an argument. Let’s do it:</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;operation&quot;</span><span class="p">,</span> 
	<span class="n">help</span><span class="o">=</span><span class="s">&quot;mathematical operation that will be performed&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">print</span> <span class="n">args</span><span class="o">.</span><span class="n">operation</span>
</code></pre></div>
<p>And we will see a better help message.</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">operation</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span> 		<span class="n">operation</span> <span class="n">mathematical</span> <span class="n">operation</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">performed</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span> <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
</code></pre></div>
<p><h2>Write the calculator</h2></p>
<p>Until this moment we are just playing with argparse features. Now, we are going to write our calculator operations.<br />
We have to add more two arguments (num1 and num2) and we will use the functions from the previous example to perform the operations. It should work.</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&#39;add&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;subtract&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;multiply&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;divide&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span>
<span class="p">}</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;operation&quot;</span><span class="p">,</span> 
	<span class="n">help</span><span class="o">=</span><span class="s">&quot;mathematical operation that will be performed&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num1&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the first number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num2&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the second number&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">print</span> <span class="n">functions</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">operation</span><span class="p">](</span><span class="n">args</span><span class="o">.</span><span class="n">num1</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">num2</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">multiply</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="n">File</span> <span class="s">&quot;calc_argparse.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">16</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>    <span class="k">print</span> <span class="n">functions</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">operation</span><span class="p">](</span><span class="n">args</span><span class="o">.</span><span class="n">num1</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">num2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="n">File</span> <span class="s">&quot;calc_argparse.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">6</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>    <span class="s">&#39;multiply&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="n">can</span><span class="s">&#39;t multiply sequence by non-int of type &#39;</span><span class="nb">str</span><span class="s">&#39;</span>
</code></pre></div>
<p>But it's not working. If we analyze the error, we can perceive that looks like the numbers are been parsed as str. It's a TypeError. When using argparse, we have to pass the argument types, it will parse with the right type and will check for type errors. Let's do it.</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&#39;add&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;subtract&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;multiply&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;divide&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span>
<span class="p">}</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;operation&quot;</span><span class="p">,</span> 
	<span class="n">help</span><span class="o">=</span><span class="s">&quot;mathematical operation that will be performed&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num1&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the first number&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num2&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the second number&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">print</span> <span class="n">functions</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">operation</span><span class="p">](</span><span class="n">args</span><span class="o">.</span><span class="n">num1</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">num2</span><span class="p">)</span>
</code></pre></div>
<p>Now everything is working fine, we also have type errors checking.</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">add</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">subtract</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">0</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">multiply</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">divide</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">1</span>

<span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">add</span> <span class="s">&#39;2&#39;</span> <span class="s">&#39;2&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">operation</span> <span class="n">num1</span> <span class="n">num2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="n">num1</span><span class="p">:</span> <span class="n">invalid</span> <span class="nb">int</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;&#39;2&#39;&quot;</span>
</code></pre></div>
<p><h2>Operation Error Checking</h2><br />
Look what happens when me try to perform a invalid operation.</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">invalid_operation</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="n">File</span> <span class="s">&quot;calc_argparse.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">16</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>    <span class="k">print</span> <span class="n">functions</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">operation</span><span class="p">](</span><span class="n">args</span><span class="o">.</span><span class="n">num1</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">num2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="s">&#39;invalid_operation&#39;</span>
</code></pre></div>
<p>Obviously, there isn't a 'invalid_operation' operation in math. So we should be limiting the available operations. With argparse, we can do it using the choices argument when we are adding an argument:</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&#39;add&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;subtract&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;multiply&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">,</span>
	<span class="s">&#39;divide&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span>
<span class="p">}</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;operation&quot;</span><span class="p">,</span> 
	<span class="n">help</span><span class="o">=</span><span class="s">&quot;mathematical operation that will be performed&quot;</span><span class="p">,</span> 
	<span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;subtract&#39;</span><span class="p">,</span> <span class="s">&#39;multiply&#39;</span><span class="p">,</span> <span class="s">&#39;divide&#39;</span><span class="p">])</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num1&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the first number&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;num2&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the second number&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">print</span> <span class="n">functions</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">operation</span><span class="p">](</span><span class="n">args</span><span class="o">.</span><span class="n">num1</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">num2</span><span class="p">)</span>
</code></pre></div>
<p>Now, if we try a different operation we will see a better error.</p>
<div class="highlight"><pre><code class="python"><span class="n">python</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="n">invalid_operation</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">usage</span><span class="p">:</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">{</span><span class="n">add</span><span class="p">,</span><span class="n">subtract</span><span class="p">,</span><span class="n">multiply</span><span class="p">,</span><span class="n">divide</span><span class="p">}</span> <span class="n">num1</span> <span class="n">num2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">calc_argparse</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> 
<span class="o">&gt;&gt;&gt;</span>		<span class="n">argument</span> <span class="n">operation</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">choice</span><span class="p">:</span> <span class="s">&#39;invalid_operation&#39;</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="p">(</span><span class="n">choose</span> <span class="kn">from</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;subtract&#39;</span><span class="p">,</span> <span class="s">&#39;multiply&#39;</span><span class="p">,</span> <span class="s">&#39;divide&#39;</span><span class="p">)</span>
</code></pre></div>
<p>This is it. With argparse, we can achieve a more robust and error-safe application with less code.</p>
</div>
</article>

<div data-type="ad" data-publisher="lqm.youvebeenhacked.site" data-zone="ron" data-format="728x90"></div>


	


<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/2013/06/16/resources-to-become-a-ninja-machine-learning/" title="Previous Post: 
Resources to become a Ninja: Machine Learning">&laquo; Resources to become a Ninja: Machine Learning</a>
         
        </div>

        <div class="next"> 
         
               <a href="/2013/06/18/resources-to-become-a-ninja-javascript/" title="next Post: 
Resources to become a Ninja: Javascript">Resources to become a Ninja: Javascript &raquo; </a> 
         
        </div>
</div> </div>
      </div>
      <footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Paulo Ortins - Blog content under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a>
</p>
</footer>
    </div>
  </div>

</body>
</html>