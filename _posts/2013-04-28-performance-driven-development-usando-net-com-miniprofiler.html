---
layout: post
title: Performance Driven Development usando .NET com MiniProfiler
categories: Performance
date: 2013-04-28
---
<p>No <a title="último post" href="http://pauloortins.wordpress.com/2013/04/23/performance-importa-e-muito/">último post</a> falei um pouco sobre a importância de se importar com a performance das nossas páginas, assim como, o quanto uma perfomance ruim impacta nos negócios das empresas. Nesse post vou falar como podemos estar mensurando a nossa performance.</p>
<p><strong>MiniProfiler</strong></p>
<p>O MiniProfiler é um framework desenvolvido pela equipe do <a title="Stack Overflow" href="http://stackoverflow.com/">Stack Overflow</a> e usando em produção tanto no Stack Overflow como no <a title="StackExchange" href="http://stackexchange.com/">StackExchange</a>. É leve, fácil de usar, e o melhor de tudo, é free e seu código está <a title="hospedado no GitHub :D" href="https://github.com/SamSaffron/MiniProfiler">hospedado no GitHub :D</a></p>
<p><strong>Como funciona</strong></p>
<p>O MiniProfiler não faz o profile automático de todos os métodos, ele teria que interagir com a CLR para observar quais métodos estão sendo executados, e isso é considerado pelo Core Team como muito invasivo.</p>
<p>Ao contrário, nós temos que adicionar Steps ao nosso código indicando as áreas que iremos fazer o profile.</p>
<p><strong>Usando o MiniProfiler</strong></p>
<p>Para exemplificar o uso do MiniProfiler, vamos criar uma aplicação padrão ASP.NET MVC4 chamada TestandoMiniProfiler.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/04/criacao-aplicacao1.png"><img class="alignnone size-full wp-image-238" alt="Criacao Aplicacao" src="http://pauloortins.com/wp-content/uploads/2013/04/criacao-aplicacao1.png" width="710" height="432" /></a></p>
<p>Para instalar o MiniProfiler basta executarmos o comando <em>Install-Package MiniProfiler.MVC3</em> no Package Manager Console.<br />
Nota: a versão é MVC3 mesmo !</p>
<p><a href="http://pauloortins.files.wordpress.com/2013/04/instalando.png"><img class="alignnone size-full wp-image-239" alt="Instalando" src="http://pauloortins.com/wp-content/uploads/2013/04/instalando1.png" width="710" height="382" /></a></p>
{% highlight html %}
@using StackExchange.Profiling @* Usando o MiniProfiler *@

<!DOCTYPE html>
<html>
<head></head>
<body>
   <header></header>
   <footer></footer>

   @Scripts.Render("~/bundles/jquery")
   @RenderSection("scripts", required: false)

   @* Renderizando CSS e Javascript*@
   @MiniProfiler.RenderIncludes()
</body>
</html>
{% endhighlight %}
<p>Adicionando os arquivos css e javascript ao final da tag <em>body</em> no arquivo <em>_Layout.shtml</em>.</p>
<p>Por último vamos configurar alguns Steps para demonstração e pronto, temos o MiniProfiler funcionando !</p>
{% highlight c# %}
public ActionResult Index()
{
   var profiler = MiniProfiler.Current; // it's ok if this is null
   using (profiler.Step("Alterando Mensagem Inicial"))
   {
      ViewBag.Message = "Nova mensagem inicial";
   }
   using (profiler.Step("Sub-Steps"))
   {
      using (profiler.Step("Sleep 100ms"))
      {
         Thread.Sleep(100);
      }
      using (profiler.Step("Sleep 250ms"))
      {
         Thread.Sleep(250);
      }
   }

   return View();
}
{% endhighlight %}
<p>Se tudo ocorreu bem, devemos ver uma tela parecida com essa, onde podemos ver o tempo de execução de cada parte do nosso código ! Rápido, fácil, e pronto pra produção !</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/04/results.png"><img class="alignnone size-full wp-image-250" alt="results" src="http://pauloortins.com/wp-content/uploads/2013/04/results.png" width="710" height="503" /></a></p>
<p><strong>Recursos Utilizados:</strong></p>
<p><a title="MiniProfiler.com" href="http://miniprofiler.com/">MiniProfiler.com</a><br />
<a title="Blog do Scott Hanselman" href="http://www.hanselman.com/blog/NuGetPackageOfTheWeek9ASPNETMiniProfilerFromStackExchangeRocksYourWorld.aspx">Blog do Scott Hanselman</a></p>
