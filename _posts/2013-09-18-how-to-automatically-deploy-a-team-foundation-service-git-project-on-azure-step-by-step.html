---
layout: post
title: How to automatically deploy a Team Foundation Service + Git Project on Azure
  (Step by Step)
categories: C#
date: 2013-09-18
---
<h2>Motivation</h2>
<p>Two weeks ago, Me and my partners, we decided to start a new project using Team Foundation Service with Git and host it on Azure. As usual, we start developing a full happy path from project creation until deployment, to test all the infrastructure involved. The TFS Account creation was OK, the Git repository was also OK, but when we tried to setup the build configuration to automatically publish our project after an automated build, we start to have some issues. We found this declaration on MSDN.</p>
<blockquote><p>
Deploying from TFS's git repository to Windows Azure is not yet supported. It is on our radar tentatively mid of this year.<br />
- Microsoft Employee
</p></blockquote>
<p>We can’t (until today) configure our Azure Website to deploy from a Git repository through Azure’s Portal. We end up, through the help of others blogs , configuring a trigger on team foundation service to publish our project after an successful commit. Community is all about share what we learn, so I decided to write a step by step tutorial that maybe can help someone with the same difficulties that we had or maybe we can receive more feedback and we improve even more our solution.</p>
<p><br/></p>
<h2>Tutorial</h2>
<p>First of all, I will assume that you already have a Team Foundation Service Account and an Azure Account, if you don't have yet, you can create them at <a href="http://tfs.visualstudio.com/">TFS</a> and at <a href="http://www.windowsazure.com/en-us/">Azure</a>.</p>
<p><br/></p>
<h2>1. Creating a Team Foundation Service + Git project.</h2>
<p>1.1 - Logged in your TFS Account. Click in "New Team Project + Git" button.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/tfs-account.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/tfs-account.png" alt="tfs-account" width="811" height="223" class="alignnone size-full wp-image-1025" /></a></p>
<p><br/><br />
1.2 - Fill up the form. Remember that you can’t rename this project in the future.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/creating-project.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/creating-project.png" alt="creating-project" width="578" height="493" class="alignnone size-full wp-image-1027" /></a></p>
<p><br/><br />
1.3 - Click on "Navigate to project" and you will see your project info.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/project-created.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/project-created.png" alt="project-created" width="761" height="391" class="alignnone size-full wp-image-1031" /></a></p>
<p><br/></p>
<h2>2. Creating a WebApp</h2>
<p>2.1 - Click on "Open new instance of Visual Studio" to open an Visual Studio instance linked to your project.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/open-new-instance.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/open-new-instance.png" alt="open-new-instance" width="272" height="200" class="alignnone size-full wp-image-1035" /></a></p>
<p><br/><br />
2.2 - Clone your git repository and choose your repository folder, remember the folder's name cause after you will create your Web Application in this same folder.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/clone-repo1.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/clone-repo1.png" alt="clone-repo1" width="314" height="273" class="alignnone size-full wp-image-1037" /></a><br />
<br/><br />
<a href="http://pauloortins.com/wp-content/uploads/2013/09/clone-repo-2.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/clone-repo-2.png" alt="clone-repo-2" width="324" height="155" class="alignnone size-full wp-image-1038" /></a></p>
<p><br/><br />
2.3 - Create a MVC 4 Web Application in your repository folder.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/creating-app.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/creating-app.png" alt="creating-app" width="808" height="457" class="alignnone size-full wp-image-1042" /></a></p>
<p><br/><br />
2.4 - Commit it. Now we have a deployable project. The next step is to create our Azure WebSite.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/commit-webapp.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/commit-webapp.png" alt="commit-webapp" width="318" height="525" class="alignnone size-full wp-image-1043" /></a></p>
<p><br/></p>
<h2>3 - Creating the Azure WebSite</h2>
<p>3.1 - Logged in your Azure Portal, create a new azure website.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/creating-web-site.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/creating-web-site.png" alt="creating-web-site" width="935" height="536" class="alignnone size-full wp-image-1045" /></a></p>
<p><br/><br />
3.2 - Download the publish profile.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/download-publish-profile.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/download-publish-profile.png" alt="download-publish-profile" width="685" height="547" class="alignnone size-full wp-image-1047" /></a></p>
<p><br/></p>
<h2>4 - Configuring the automated deploy</h2>
<p>4.1 - Import the publish profile that we downloaded. It will create a publish profile folder in our MVC project.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/importing-publish-profile.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/importing-publish-profile.png" alt="importing-publish-profile" width="1105" height="589" class="alignnone size-full wp-image-1048" /></a></p>
<p><br/><br />
4.2 - Configure a new build definition.</p>
<p>Go to Team Explorer -> Builds -> New Build Definition and create a new build definition.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/team-explorer-new-build.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/team-explorer-new-build.png" alt="team-explorer-new-build" width="330" height="318" class="alignnone size-full wp-image-1050" /></a></p>
<p>On Trigger Tab, set the “Continuous Integration” radio, so the build will occur after each check in.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/trigger-tab.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/trigger-tab.png" alt="trigger-tab" width="910" height="324" class="alignnone size-full wp-image-1051" /></a></p>
<p>On Source Settings Tab, select the managed branch.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/source-settings.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/source-settings.png" alt="source-settings" width="581" height="255" class="alignnone size-full wp-image-1052" /></a></p>
<p>On Process Tab, fill the solution to build field with 'MyApp.sln'.</p>
<p>Also fill the MsBuild arguments field with the following value:</p>
<p>/p:DeployOnBuild=true /p:PublishProfile="pauloortinsblog - Web Deploy" /p:AllowUntrustedCertificate=true /p:UserName=$pauloortinsblog /p:Password=Re7ACb3g6By9idLoi6gsWGbdc8AK49HxqaEFNzxxxxxxxxxxxxxxx /p:VisualStudioVersion=11.0</p>
<p>You should get the UserName and the Password from the Publish Profile file.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/publish-settings2.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/publish-settings2.png" alt="publish-settings" width="999" height="167" class="alignnone size-full wp-image-1088" /></a></p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/process-tab.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/process-tab.png" alt="process-tab" width="1418" height="453" class="alignnone size-full wp-image-1055" /></a></p>
<p><br/><br />
4.3 - Enable Build Services.</p>
<p>On your TFS Account -> Build Section, you need to add the build services to your account in the following section.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/enable-build.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/enable-build.png" alt="enable-build" width="633" height="236" class="alignnone size-full wp-image-1053" /></a></p>
<p><br/></p>
<h2>5 - Testing the happy path</h2>
<p>5.1 - Let's make a change in one of our files, Index.cshtml.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/change.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/change.png" alt="change" width="976" height="376" class="alignnone size-full wp-image-1059" /></a></p>
<p><br/><br />
5.2 - Committing the change and pushing it to the repository.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/testing-happy-path.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/testing-happy-path.png" alt="testing-happy-path" width="306" height="458" class="alignnone size-full wp-image-1060" /></a></p>
<p><br/><br />
<a href="http://pauloortins.com/wp-content/uploads/2013/09/pushing.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/pushing.png" alt="pushing" width="329" height="344" class="alignnone size-full wp-image-1061" /></a></p>
<p><br/><br />
5.3 - A new build was queued on Team Foundation Service</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/build-queued.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/build-queued.png" alt="build queued" width="965" height="203" class="alignnone size-full wp-image-1062" /></a></p>
<p><br/><br />
5.4 - After the build the finished, the WebApp was deployed automatically.</p>
<p><a href="http://pauloortins.com/wp-content/uploads/2013/09/website.png"><img src="http://pauloortins.com/wp-content/uploads/2013/09/website.png" alt="website" width="1125" height="384" class="alignnone size-full wp-image-1063" /></a></p>
<p><br/></p>
<h2>Conclusion</h2>
<p>This is it. I hope this post might help someone. You can also feel free to suggest an improvement in this process!</p>
